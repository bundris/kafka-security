# Kafka security
## Постановка задачи
Поднять 3 брокера, кластер должен работать по защищенному SSL соединению + доступ внешним клиентам по SASL/PLAIN с ограничением прав ACL. Протестировать работоспособность: создать топики, продюсерами слать туда сообщения, в первый топик должен подключаться консьюмер с правом чтения, в второй - без прав.

## Решение
За основу возьмем практическую работу 2 (из спринта 1) и SingleConsumer.

### Получение сертификатов
Сперва получаем root CA, затем с его помощью создаем сертификаты для брокеров, затем заводим pkcs12 хранилища, keystore и truststore. В конце сохраняем пароли (в нашем случае один пароль на всех)
Для простоты воспроизведения все команды собраны в certs/gen.sh
```shell
./certs/gen.sh
```
### Создание топиков
Запускаем скрипт для создания топиков
```shell
./infrastructure/create-topic.sh
```
### Настройка ACL
Чтобы реализовать настройку прав, надо внедрить аутентификацию. Будем использовать SASL/PLAIN.

SASL конфиги находятся в директории infrastructure/sasl.
Для внутреннего общения c zookeeper используем DigestLoginModule и логин контексты Client (в брокерах) / Server (в zookeeper).

Для общения между клиентами (продюсерами, консьюмерами) с брокерами испольуем PlainLoginModule. Для продюсеров будем использовать пользователя admin, для консьюмеров это будут пользователи user1 и user2.

Чтобы задать права на топики, нужно запустить скрипт.
```shell
./infrastructure/acl.sh
```

### Запуск контейнеров
Чтобы поднять kafka кластер, нужно выполнить
```
docker compose -f infrastructure/docker-compose.yml up -d
```

В том же docker-compose.yml определен контейнер с приложением, чтобы консьюмеры и продюсеры работали в той же сети, что и kafka брокеры